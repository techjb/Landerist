<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="description" content="Landerist Statistics" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@techjb" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            line-height: 1.4;
            font-size: 16px;
            padding: 0 10px;
            margin: 50px auto;
            max-width: 650px;
        }

        #maincontent {
            max-width: 42em;
            margin-top: 70px;
        }

        canvas {
            margin: 20px 0px;
        }
    </style>
    <title>Statistics</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div id="maincontent">
        <a href="../">< Home</a>

        <h2>
            Statistics
        </h2>

        <div id="Statistics">

        </div>
    </div>

    <script>

        const palette = [
            "rgb(75, 192, 192)",
            "rgb(255, 99, 132)",
            "rgb(54, 162, 235)",
            "rgb(255, 205, 86)",
            "rgb(153, 102, 255)",
            "rgb(201, 203, 207)"
        ];

        function GetPlugins(title) {
            return {
                legend: {
                    display: false
                },
                title: {
                    display: true,
                    text: title
                }
            };
        }


        CreateLineChart("Listings", [/*Listings*/]);
        CreateLineChart("Published listings", [/*PublishedListings*/]);
        CreateLineChart("Unpublished listings", [/*UnpublishedListings*/]);
        CreateLineChart("Websites", [/*Websites*/]);
        CreateLineChart("Pages", [/*Pages*/]);
        CreateLineChart("Updated pages", [/*UpdatedPages*/]);
        CreateLineChart("Need update", [/*NeedUpdate*/]);
        CreateLineChart("Total unknown PageType", [/*UnknownPageType*/]);
        CreateLineChart("HttpStatusCode 200", [/*HttpStatusCode_200*/]);
        CreateLineChart("HttpStatusCode NULL", [/*HttpStatusCode_NULL*/]);
        CreateAreaChart("HttpStatusCode Errors", [/*HttpStatusCode*/]);
        CreateAreaChart("PageType", [/*PageType*/]);
        CreateAreaChart("Scraped pages", [/*ScrapedPages*/]);
        CreateAreaChart("Batch readed", [/*BatchReaded*/]);
        CreateAreaChart("Listing insert update", [/*ListingInsertUpdate*/]);
        CreatePieChart("Published Listings PageType", [/*publishedPageType*/]);
        CreatePieChart("Unpublished Listings PageType", [/*unpublishedPageType*/]);




        function CreateLineChart(title, values) {
            const data = {
                labels: values.map(row => row.date),
                datasets: [{
                    data: values.map(row => row.count),
                }]
            };
            var options = {
                responsive: true,
                plugins: GetPlugins(title)
            }
            CreateChart('line', data, options);
        }

        function CreateAreaChart(title, values) {
            const data = {
                labels: values[0].values.map(row => row.date),
                datasets: values.map((serie, idx) => {
                    return {
                        label: serie.label,
                        data: serie.values.map(row => row.count),
                        fill: true,
                        borderColor: palette[idx % palette.length],
                        backgroundColor: palette[idx % palette.length],
                        tension: 0.1,
                        stack: 'stack1'
                    };
                })
            };
            var options = {
                responsive: true,
                plugins: GetPlugins(title),
                scales: {
                    x: {
                        stacked: true
                    },
                    y: {
                        stacked: true,
                        beginAtZero: true
                    }
                }
            }
            CreateChart('line', data, options);
        }

        function CreatePieChart(title, values) {
            const data = {
                labels: values.map(row => row.label),
                datasets: [{
                    label: title,
                    data: values.map(row => row.value),                    
                    borderColor: palette,
                    backgroundColor: palette,
                }]
            }

            var options = {
                responsive: true,
                plugins: GetPlugins(title),
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
            CreateChart('pie', data, options);
        }
      
        function CreateChart(type, data, options) {
            const config = {
                type: type,
                data: data,
                options: options,
            };

            const canvas = document.createElement('canvas');
            new Chart(canvas, config);
            document.getElementById("Statistics").appendChild(canvas);
        }
    </script>
</body>
</html>